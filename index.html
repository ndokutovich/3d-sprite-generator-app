<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Model to 8-Directional Sprite Generator</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23667eea;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23764ba2;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath fill='url(%23grad)' d='M50 10 L85 30 L85 70 L50 90 L15 70 L15 30 Z'/%3E%3Cpath fill='%23fff' opacity='0.3' d='M50 10 L85 30 L50 50 Z'/%3E%3Cpath fill='%23fff' opacity='0.5' d='M50 50 L85 30 L85 70 L50 90 Z'/%3E%3Cpath fill='%23fff' opacity='0.7' d='M50 50 L15 30 L15 70 L50 90 Z'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>üéÆ 3D Model to Sprite Generator</h1>
                    <p>Load 3D models and create 8-directional sprites</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="undoBtn" class="header-btn" disabled title="Undo (Ctrl+Z)">‚Ü∂ Undo</button>
                    <button id="redoBtn" class="header-btn" disabled title="Redo (Ctrl+Shift+Z)">‚Ü∑ Redo</button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="controls">
                <div class="control-group">
                    <h3>üìÅ Load 3D Model</h3>
                    <div class="file-input-wrapper">
                        <input type="file" id="modelFile" accept=".glb,.gltf,.fbx,.stl,.obj">
                        <label for="modelFile" class="file-input-label">Choose Model File</label>
                    </div>
                    <div class="file-name" id="fileName">No file selected</div>
                    <div class="info-box">
                        Supports: GLB, GLTF, FBX, STL, OBJ
                    </div>
                </div>

                <div class="control-group">
                    <h3>üé¨ Animation</h3>
                    <label for="animationSelect">Select Animation:</label>
                    <select id="animationSelect" disabled>
                        <option value="-1">No Animation</option>
                    </select>

                    <div style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="autoplayAnimation" style="width: auto;">
                        <label for="autoplayAnimation" style="margin: 0; cursor: pointer;">
                            ‚ñ∂Ô∏è Autoplay Animation
                        </label>
                    </div>

                    <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="lockPosition" style="width: auto;">
                        <label for="lockPosition" style="margin: 0; cursor: pointer;">
                            üìç Lock Position (Stay in Place)
                        </label>
                    </div>

                    <label for="animationTime" style="margin-top: 15px;">
                        Animation Time: <span class="range-value" id="timeValue">0.0s</span>
                    </label>
                    <input type="range" id="animationTime" min="0" max="1" step="0.01" value="0" disabled>

                    <div style="margin-top: 15px;">
                        <div class="file-input-wrapper">
                            <input type="file" id="animationFile" accept=".fbx,.glb,.gltf">
                            <label for="animationFile" class="file-input-label">Upload Animation (FBX/GLB)</label>
                        </div>
                        <div class="info-box" style="margin-top: 10px;">
                            Upload Mixamo animations or custom skeletal animations. Skeleton must match your model.
                        </div>
                    </div>

                    <label for="animationFrames" style="margin-top: 15px;">
                        Animation Frames (for sprite generation):
                    </label>
                    <input type="number" id="animationFrames" value="1" min="1" max="32" step="1">
                    <div class="info-box">
                        Set to 1 for static pose, or higher (e.g. 4-8) to capture animation frames for each direction
                    </div>
                </div>

                <div class="control-group">
                    <h3>üé® Render Settings</h3>
                    <label for="spriteSize">Sprite Size (px):</label>
                    <input type="number" id="spriteSize" value="512" min="64" max="2048" step="64">

                    <label for="cameraDistance" style="margin-top: 15px;">
                        Camera Distance: <span class="range-value" id="distanceValue">3.0</span>
                    </label>
                    <input type="range" id="cameraDistance" min="1" max="20" step="0.5" value="3">

                    <label for="cameraHeight" style="margin-top: 15px;">
                        Camera Height: <span class="range-value" id="heightValue">1.5</span>
                    </label>
                    <input type="range" id="cameraHeight" min="0" max="5" step="0.1" value="1.5">

                    <label for="lightIntensity" style="margin-top: 15px;">
                        Light Intensity: <span class="range-value" id="lightValue">3.0</span>
                    </label>
                    <input type="range" id="lightIntensity" min="0" max="10" step="0.1" value="3.0">

                    <label for="directionCount" style="margin-top: 15px;">Direction Count:</label>
                    <select id="directionCount">
                        <option value="8">8 Directions</option>
                        <option value="16">16 Directions</option>
                    </select>

                    <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="singleDirection" style="width: auto;">
                        <label for="singleDirection" style="margin: 0; cursor: pointer;">
                            üëÅÔ∏è Single Direction Only (Current View)
                        </label>
                    </div>
                    <div class="info-box" style="margin-top: 5px; display: none;" id="singleDirectionInfo">
                        Will only generate sprites from the current camera angle. Perfect for side-scrolling games!
                    </div>
                </div>

                <div class="control-group">
                    <h3>‚öîÔ∏è Equipment Inventory</h3>

                    <label for="equipmentSlot">Equipment Slot:</label>
                    <select id="equipmentSlot">
                        <option value="weapon">‚öîÔ∏è Weapon (Right Hand)</option>
                        <option value="shield">üõ°Ô∏è Shield/Offhand (Left Hand)</option>
                        <option value="helmet">ü™ñ Helmet (Head)</option>
                        <option value="chest">ü¶∫ Chest Armor (Torso)</option>
                        <option value="legs">üëñ Leg Armor (Hips)</option>
                        <option value="boots">üë¢ Boots (Feet)</option>
                        <option value="back">üéí Back/Cape (Shoulders)</option>
                    </select>

                    <div class="file-input-wrapper" style="margin-top: 10px;">
                        <input type="file" id="equipmentFile" accept=".glb,.gltf,.fbx,.obj">
                        <label for="equipmentFile" class="file-input-label">Load to Slot</label>
                    </div>
                    <div class="info-box">
                        Supports: GLB, GLTF, FBX, OBJ
                    </div>

                    <!-- Inventory List -->
                    <div style="margin-top: 15px;">
                        <h4 style="margin-bottom: 10px;">üì¶ Inventory:</h4>
                        <div id="inventoryList" class="inventory-list">
                            <div class="empty-inventory">No equipment loaded</div>
                        </div>
                    </div>

                    <!-- Equipment Actions -->
                    <div style="margin-top: 10px; display: flex; gap: 10px;">
                        <button id="equipAllBtn" disabled style="flex: 1;">Equip All</button>
                        <button id="unequipAllBtn" disabled style="flex: 1;">Unequip All</button>
                    </div>

                    <!-- Bone Viewer -->
                    <div style="margin-top: 10px;">
                        <button id="viewBonesBtn" disabled style="background: #28a745;">ü¶¥ View Skeleton Bones</button>
                    </div>

                    <!-- Equipment Adjustment -->
                    <div style="margin-top: 10px;">
                        <details>
                            <summary style="cursor: pointer; user-select: none;">‚öôÔ∏è Adjust Selected Equipment</summary>
                            <div style="margin-top: 10px;">
                                <select id="adjustEquipmentSlot" disabled style="margin-bottom: 10px;">
                                    <option value="">Select equipped item...</option>
                                </select>

                                <!-- Preset Indicator -->
                                <div id="presetIndicator" style="display: none; background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; border-radius: 4px; padding: 8px; margin-bottom: 10px; font-size: 13px;">
                                    <span style="color: #4caf50;">‚ú® Preset Active</span>
                                    <button id="clearPresetBtn" style="float: right; background: #dc3545; padding: 2px 8px; font-size: 11px; border-radius: 3px;">Clear</button>
                                    <div style="clear: both;"></div>
                                    <div style="margin-top: 5px; color: #aaa; font-size: 11px;">Saved settings auto-applied</div>
                                </div>

                                <label><strong>Scale:</strong> <span id="equipScaleValue">1.00</span>x</label>
                                <input type="range" id="equipScale" min="0.1" max="10" step="0.1" value="1" disabled>

                                <hr style="margin: 10px 0; border: 1px solid #444;">

                                <label>Position X: <span id="equipXValue">0.00</span></label>
                                <input type="range" id="equipX" min="-0.5" max="0.5" step="0.01" value="0" disabled>

                                <label style="margin-top: 5px;">Position Y: <span id="equipYValue">0.00</span></label>
                                <input type="range" id="equipY" min="-0.5" max="0.5" step="0.01" value="0" disabled>

                                <label style="margin-top: 5px;">Position Z: <span id="equipZValue">0.00</span></label>
                                <input type="range" id="equipZ" min="-0.5" max="0.5" step="0.01" value="0" disabled>

                                <hr style="margin: 10px 0; border: 1px solid #444;">

                                <label>Rotation X: <span id="equipRotXValue">0</span>¬∞</label>
                                <input type="range" id="equipRotX" min="-180" max="180" step="5" value="0" disabled>

                                <label style="margin-top: 5px;">Rotation Y: <span id="equipRotYValue">0</span>¬∞</label>
                                <input type="range" id="equipRotY" min="-180" max="180" step="5" value="0" disabled>

                                <label style="margin-top: 5px;">Rotation Z: <span id="equipRotZValue">0</span>¬∞</label>
                                <input type="range" id="equipRotZ" min="-180" max="180" step="5" value="0" disabled>
                            </div>
                        </details>
                    </div>

                    <!-- Preset Manager -->
                    <div style="margin-top: 10px;">
                        <button id="openPresetManagerBtn" style="width: 100%; background: #6c5ce7;">
                            üíæ Manage Equipment Presets
                        </button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>üîß Quick Rotation Test</h3>
                    <div class="info-box" style="margin-bottom: 10px;">
                        <strong>Rotate the loaded 3D model</strong> to test different orientations. Click values to apply rotation per axis. Great for finding the perfect angle before sprite generation!
                    </div>

                    <div style="background: #1a1a2e; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-size: 12px;">
                        <div style="margin-bottom: 8px;">
                            <strong style="color: #ff6b6b;">X:</strong>
                            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 2px; margin-top: 3px;">
                                <button class="rotation-test-btn" data-axis="x" data-value="0" style="padding: 4px 2px; font-size: 11px;">0</button>
                                <button class="rotation-test-btn" data-axis="x" data-value="90" style="padding: 4px 2px; font-size: 11px;">+90</button>
                                <button class="rotation-test-btn" data-axis="x" data-value="-90" style="padding: 4px 2px; font-size: 11px;">-90</button>
                                <button class="rotation-test-btn" data-axis="x" data-value="180" style="padding: 4px 2px; font-size: 11px;">¬±180</button>
                                <button class="rotation-test-btn" data-axis="x" data-value="270" style="padding: 4px 2px; font-size: 11px;">+270</button>
                                <button class="rotation-test-btn" data-axis="x" data-value="-270" style="padding: 4px 2px; font-size: 11px;">-270</button>
                            </div>
                        </div>

                        <div style="margin-bottom: 8px;">
                            <strong style="color: #51cf66;">Y:</strong>
                            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 2px; margin-top: 3px;">
                                <button class="rotation-test-btn" data-axis="y" data-value="0" style="padding: 4px 2px; font-size: 11px;">0</button>
                                <button class="rotation-test-btn" data-axis="y" data-value="90" style="padding: 4px 2px; font-size: 11px;">+90</button>
                                <button class="rotation-test-btn" data-axis="y" data-value="-90" style="padding: 4px 2px; font-size: 11px;">-90</button>
                                <button class="rotation-test-btn" data-axis="y" data-value="180" style="padding: 4px 2px; font-size: 11px;">¬±180</button>
                                <button class="rotation-test-btn" data-axis="y" data-value="270" style="padding: 4px 2px; font-size: 11px;">+270</button>
                                <button class="rotation-test-btn" data-axis="y" data-value="-270" style="padding: 4px 2px; font-size: 11px;">-270</button>
                            </div>
                        </div>

                        <div>
                            <strong style="color: #4dabf7;">Z:</strong>
                            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 2px; margin-top: 3px;">
                                <button class="rotation-test-btn" data-axis="z" data-value="0" style="padding: 4px 2px; font-size: 11px;">0</button>
                                <button class="rotation-test-btn" data-axis="z" data-value="90" style="padding: 4px 2px; font-size: 11px;">+90</button>
                                <button class="rotation-test-btn" data-axis="z" data-value="-90" style="padding: 4px 2px; font-size: 11px;">-90</button>
                                <button class="rotation-test-btn" data-axis="z" data-value="180" style="padding: 4px 2px; font-size: 11px;">¬±180</button>
                                <button class="rotation-test-btn" data-axis="z" data-value="270" style="padding: 4px 2px; font-size: 11px;">+270</button>
                                <button class="rotation-test-btn" data-axis="z" data-value="-270" style="padding: 4px 2px; font-size: 11px;">-270</button>
                            </div>
                        </div>
                    </div>

                    <div style="background: #2a2a3e; padding: 15px; border-radius: 5px; font-size: 16px; font-family: monospace;">
                        <strong>Current Rotation:</strong><br>
                        <span style="color: #ff6b6b;">X: <span id="currentRotX">180</span>¬∞</span> |
                        <span style="color: #51cf66;">Y: <span id="currentRotY">0</span>¬∞</span> |
                        <span style="color: #4dabf7;">Z: <span id="currentRotZ">0</span>¬∞</span>
                    </div>
                </div>

                <div class="control-group">
                    <h3>üéØ Gizmo Controls</h3>
                    <div class="info-box" style="margin-bottom: 10px;">
                        Interactive 3D gizmos for precise control of camera, character, and equipment positioning.
                    </div>

                    <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="enableGizmo" style="width: auto;">
                        <label for="enableGizmo" style="margin: 0; cursor: pointer;">
                            ‚ú® Enable Gizmo
                        </label>
                    </div>

                    <label for="gizmoTarget">Control Target:</label>
                    <select id="gizmoTarget" disabled>
                        <option value="">Select target...</option>
                        <option value="character">üßç Character</option>
                        <option value="equipment">‚öîÔ∏è Equipment</option>
                    </select>
                    <div class="info-box" style="margin-top: 5px; font-size: 0.85em;">
                        üì∑ Camera gizmo always visible in top-right corner
                    </div>

                    <div id="equipmentGizmoSelect" style="margin-top: 10px; display: none;">
                        <label for="gizmoEquipmentSlot">Equipment Item:</label>
                        <select id="gizmoEquipmentSlot" disabled>
                            <option value="">Select equipped item...</option>
                        </select>
                    </div>

                    <label style="margin-top: 15px;">Transform Mode:</label>
                    <div style="display: flex; gap: 5px; margin-top: 5px;">
                        <button id="gizmoModeTranslate" class="gizmo-mode-btn active" disabled>üìç Move</button>
                        <button id="gizmoModeRotate" class="gizmo-mode-btn" disabled>üîÑ Rotate</button>
                        <button id="gizmoModeScale" class="gizmo-mode-btn" disabled>üìè Scale</button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>üìê Camera Properties</h3>
                    <div class="info-box" style="margin-bottom: 15px;">
                        Precise camera transform control. All 9 parameters with reset to defaults.
                    </div>

                    <!-- Camera Angles Display -->
                    <div style="background: #1a1a2e; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-family: 'Courier New', monospace; font-size: 14px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; text-align: center;">
                            <div style="background: rgba(255, 59, 48, 0.2); padding: 8px; border-radius: 4px;">
                                <div style="color: #ff6b6b; font-size: 11px; margin-bottom: 4px;">PITCH</div>
                                <div style="color: #fff; font-size: 16px; font-weight: bold;"><span id="cameraPitch">0</span>¬∞</div>
                            </div>
                            <div style="background: rgba(52, 199, 89, 0.2); padding: 8px; border-radius: 4px;">
                                <div style="color: #51cf66; font-size: 11px; margin-bottom: 4px;">YAW</div>
                                <div style="color: #fff; font-size: 16px; font-weight: bold;"><span id="cameraYaw">0</span>¬∞</div>
                            </div>
                            <div style="background: rgba(10, 132, 255, 0.2); padding: 8px; border-radius: 4px;">
                                <div style="color: #4dabf7; font-size: 11px; margin-bottom: 4px;">ROLL</div>
                                <div style="color: #fff; font-size: 16px; font-weight: bold;"><span id="cameraRoll">0</span>¬∞</div>
                            </div>
                        </div>
                    </div>

                    <details open>
                        <summary style="cursor: pointer; user-select: none; font-weight: bold; margin-bottom: 15px;">üìç Position</summary>

                        <label>Position X: <span id="camPosXValue">3.00</span></label>
                        <input type="range" id="camPosX" min="-20" max="20" step="0.1" value="3">

                        <label style="margin-top: 5px;">Position Y: <span id="camPosYValue">1.50</span></label>
                        <input type="range" id="camPosY" min="-10" max="10" step="0.1" value="1.5">

                        <label style="margin-top: 5px;">Position Z: <span id="camPosZValue">3.00</span></label>
                        <input type="range" id="camPosZ" min="-20" max="20" step="0.1" value="3">
                    </details>

                    <details open style="margin-top: 10px;">
                        <summary style="cursor: pointer; user-select: none; font-weight: bold; margin-bottom: 15px;">üîÑ Rotation</summary>

                        <label>Rotation X: <span id="camRotXValue">0</span>¬∞</label>
                        <input type="range" id="camRotX" min="-180" max="180" step="1" value="0">

                        <label style="margin-top: 5px;">Rotation Y: <span id="camRotYValue">0</span>¬∞</label>
                        <input type="range" id="camRotY" min="-180" max="180" step="1" value="0">

                        <label style="margin-top: 5px;">Rotation Z: <span id="camRotZValue">0</span>¬∞</label>
                        <input type="range" id="camRotZ" min="-180" max="180" step="1" value="0">
                    </details>

                    <details open style="margin-top: 10px;">
                        <summary style="cursor: pointer; user-select: none; font-weight: bold; margin-bottom: 15px;">üìè Scale / Zoom</summary>

                        <label>Scale X: <span id="camScaleXValue">1.00</span>x</label>
                        <input type="range" id="camScaleX" min="0.1" max="5" step="0.1" value="1">

                        <label style="margin-top: 5px;">Scale Y: <span id="camScaleYValue">1.00</span>x</label>
                        <input type="range" id="camScaleY" min="0.1" max="5" step="0.1" value="1">

                        <label style="margin-top: 5px;">Scale Z (Zoom): <span id="camScaleZValue">1.00</span>x</label>
                        <input type="range" id="camScaleZ" min="0.1" max="5" step="0.1" value="1">
                    </details>

                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button id="pointToCenterBtn" style="flex: 1; background: #28a745;">
                            üéØ Point to Center
                        </button>
                        <button id="resetCameraBtn" style="flex: 1; background: #dc3545;">
                            üîÑ Reset All
                        </button>
                    </div>
                </div>

                <div class="control-group">
                    <h3>üì∏ Generate Sprites</h3>
                    <button id="generateBtn" disabled>Generate 8-Direction Sprites</button>
                    <button id="downloadBtn" disabled>Download ZIP Archive</button>
                    <div class="success-message" id="successMessage">
                        ‚úì Sprites generated successfully!
                    </div>
                </div>
            </div>

            <div class="viewport">
                <canvas id="canvas3d"></canvas>
                <div class="loading" id="loading" style="display: none;">
                    <div class="spinner"></div>
                    <div class="loading-status" id="loadingStatus">Loading model...</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <div class="error-message" id="errorMessage">
                    <h3>‚ö†Ô∏è Error Loading Model</h3>
                    <p id="errorText"></p>
                    <button onclick="document.getElementById('errorMessage').style.display='none'">Close</button>
                </div>
            </div>
        </div>

        <div class="sprite-preview" id="spritePreview" style="display: none;">
            <!-- Sprites will be inserted here -->
        </div>
    </div>

    <!-- Modal for sprite zoom -->
    <div class="sprite-modal" id="spriteModal">
        <div class="sprite-modal-content">
            <span class="sprite-modal-close" id="modalClose">&times;</span>
            <img id="modalImage" src="" alt="Sprite preview">
            <p id="modalCaption"></p>
        </div>
    </div>

    <!-- Bone Viewer Modal -->
    <div class="bone-viewer-modal" id="boneViewerModal" style="display: none;">
        <div class="bone-viewer-content">
            <div class="bone-viewer-header">
                <h2>ü¶¥ Skeleton Bone Viewer</h2>
                <span class="bone-viewer-close" id="boneViewerClose">&times;</span>
            </div>

            <div class="bone-viewer-body">
                <div class="bone-viewer-section">
                    <h3>üìä Rig Analysis</h3>
                    <div id="rigStats" class="rig-stats"></div>
                </div>

                <div class="bone-viewer-tabs">
                    <button class="bone-tab active" data-tab="hierarchy">Bone Hierarchy</button>
                    <button class="bone-tab" data-tab="mapping">Auto Mapping</button>
                    <button class="bone-tab" data-tab="manual">‚úèÔ∏è Manual Mapping</button>
                    <button class="bone-tab" data-tab="comparison">Rig Comparison</button>
                </div>

                <div class="bone-viewer-tab-content">
                    <!-- Hierarchy Tab -->
                    <div id="hierarchyTab" class="tab-pane active">
                        <div class="bone-tree" id="boneTree"></div>
                    </div>

                    <!-- Auto Mapping Tab -->
                    <div id="mappingTab" class="tab-pane">
                        <div class="mapping-controls">
                            <button id="autoMapBtn" class="mapping-btn">üîÑ Auto-Map to Mixamo</button>
                            <button id="copyMappingBtn" class="mapping-btn">üìã Copy Mapping Code</button>
                        </div>
                        <div id="boneMapping" class="bone-mapping"></div>
                    </div>

                    <!-- Manual Mapping Tab -->
                    <div id="manualTab" class="tab-pane">
                        <div class="mapping-controls">
                            <button id="fillFromAutoBtn" class="mapping-btn">ü§ñ Fill from Auto-Map</button>
                            <button id="saveMappingBtn" class="mapping-btn">üíæ Save Mapping</button>
                            <button id="loadMappingBtn" class="mapping-btn">üìÇ Load Mapping</button>
                            <button id="clearMappingBtn" class="mapping-btn" style="background: #dc3545;">üóëÔ∏è Clear All</button>
                        </div>
                        <div class="info-box" style="margin: 15px 0;">
                            <strong>Manual Mapping Editor</strong><br>
                            Map your custom rig bones to Mixamo standard bones for 100% accurate animation retargeting.
                            Mapping is saved to browser localStorage.
                        </div>
                        <div id="manualMappingEditor" class="manual-mapping-editor"></div>
                    </div>

                    <!-- Comparison Tab -->
                    <div id="comparisonTab" class="tab-pane">
                        <div class="comparison-grid">
                            <div class="comparison-column">
                                <h4>Current Rig</h4>
                                <div id="currentRigList" class="bone-list"></div>
                            </div>
                            <div class="comparison-column">
                                <h4>Mixamo Standard</h4>
                                <div id="mixamoRigList" class="bone-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Equipment Preset Manager Modal -->
    <div class="bone-viewer-modal" id="presetManagerModal" style="display: none;">
        <div class="bone-viewer-content">
            <div class="bone-viewer-header">
                <h2>üíæ Equipment Preset Manager</h2>
                <span class="bone-viewer-close" id="presetManagerClose">&times;</span>
            </div>

            <div class="bone-viewer-body">
                <div class="bone-viewer-section">
                    <div class="info-box" style="margin-bottom: 15px;">
                        <strong>Saved Equipment Presets</strong><br>
                        Equipment position/rotation/scale settings are automatically saved per model-equipment-bone combination.
                        View and manage all saved presets below.
                    </div>

                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button id="refreshPresetsBtn" class="mapping-btn" style="flex: 1;">
                            üîÑ Refresh
                        </button>
                        <button id="clearAllPresetsBtn" class="mapping-btn" style="flex: 1; background: #dc3545;">
                            üóëÔ∏è Clear All Presets
                        </button>
                    </div>

                    <div id="presetCount" style="margin-bottom: 15px; padding: 10px; background: #1a1a2e; border-radius: 5px; text-align: center; font-weight: bold;">
                        Loading presets...
                    </div>

                    <div id="presetsList" style="max-height: 400px; overflow-y: auto;">
                        <!-- Presets will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Third-party libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <!-- fflate is required for FBX loader to decompress FBX files -->
    <script src="https://cdn.jsdelivr.net/npm/fflate@0.7.4/umd/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Application modules (order matters) -->
    <script src="js/config.js"></script>
    <!-- Utility classes (no dependencies) -->
    <script src="js/sprite.js"></script>
    <script src="js/animation-frame-calculator.js"></script>
    <script src="js/animation-library.js"></script>
    <script src="js/undo-manager.js"></script>
    <!-- Core modules -->
    <script src="js/ui-controller.js"></script>
    <script src="js/three-setup.js"></script>
    <script src="js/model-loader.js"></script>
    <script src="js/animation-controller.js"></script>
    <script src="js/equipment-manager.js"></script>
    <script src="js/gizmo-controller.js"></script>
    <script src="js/sprite-generator.js"></script>
    <script src="js/file-handler.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
