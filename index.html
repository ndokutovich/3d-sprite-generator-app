<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Model to 8-Directional Sprite Generator</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23667eea;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23764ba2;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath fill='url(%23grad)' d='M50 10 L85 30 L85 70 L50 90 L15 70 L15 30 Z'/%3E%3Cpath fill='%23fff' opacity='0.3' d='M50 10 L85 30 L50 50 Z'/%3E%3Cpath fill='%23fff' opacity='0.5' d='M50 50 L85 30 L85 70 L50 90 Z'/%3E%3Cpath fill='%23fff' opacity='0.7' d='M50 50 L15 30 L15 70 L50 90 Z'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ 3D Model to Sprite Generator</h1>
            <p>Load 3D models and create 8-directional sprites</p>
        </div>

        <div class="main-content">
            <div class="controls">
                <div class="control-group">
                    <h3>üìÅ Load 3D Model</h3>
                    <div class="file-input-wrapper">
                        <input type="file" id="modelFile" accept=".glb,.gltf,.fbx,.stl,.obj">
                        <label for="modelFile" class="file-input-label">Choose Model File</label>
                    </div>
                    <div class="file-name" id="fileName">No file selected</div>
                    <div class="info-box">
                        Supports: GLB, GLTF, FBX, STL, OBJ
                    </div>
                </div>

                <div class="control-group">
                    <h3>üé¨ Animation</h3>
                    <label for="animationSelect">Select Animation:</label>
                    <select id="animationSelect" disabled>
                        <option value="-1">No Animation</option>
                    </select>

                    <div style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="autoplayAnimation" style="width: auto;">
                        <label for="autoplayAnimation" style="margin: 0; cursor: pointer;">
                            ‚ñ∂Ô∏è Autoplay Animation
                        </label>
                    </div>

                    <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="lockPosition" style="width: auto;">
                        <label for="lockPosition" style="margin: 0; cursor: pointer;">
                            üìç Lock Position (Stay in Place)
                        </label>
                    </div>

                    <label for="animationTime" style="margin-top: 15px;">
                        Animation Time: <span class="range-value" id="timeValue">0.0s</span>
                    </label>
                    <input type="range" id="animationTime" min="0" max="1" step="0.01" value="0" disabled>

                    <div style="margin-top: 15px;">
                        <div class="file-input-wrapper">
                            <input type="file" id="animationFile" accept=".fbx,.glb,.gltf">
                            <label for="animationFile" class="file-input-label">Upload Animation (FBX/GLB)</label>
                        </div>
                        <div class="info-box" style="margin-top: 10px;">
                            Upload Mixamo animations or custom skeletal animations. Skeleton must match your model.
                        </div>
                    </div>

                    <label for="animationFrames" style="margin-top: 15px;">
                        Animation Frames (for sprite generation):
                    </label>
                    <input type="number" id="animationFrames" value="1" min="1" max="32" step="1">
                    <div class="info-box">
                        Set to 1 for static pose, or higher (e.g. 4-8) to capture animation frames for each direction
                    </div>
                </div>

                <div class="control-group">
                    <h3>üé® Render Settings</h3>
                    <label for="spriteSize">Sprite Size (px):</label>
                    <input type="number" id="spriteSize" value="512" min="64" max="2048" step="64">

                    <label for="cameraDistance" style="margin-top: 15px;">
                        Camera Distance: <span class="range-value" id="distanceValue">3.0</span>
                    </label>
                    <input type="range" id="cameraDistance" min="1" max="20" step="0.5" value="3">

                    <label for="cameraHeight" style="margin-top: 15px;">
                        Camera Height: <span class="range-value" id="heightValue">1.5</span>
                    </label>
                    <input type="range" id="cameraHeight" min="0" max="5" step="0.1" value="1.5">

                    <label for="lightIntensity" style="margin-top: 15px;">
                        Light Intensity: <span class="range-value" id="lightValue">3.0</span>
                    </label>
                    <input type="range" id="lightIntensity" min="0" max="10" step="0.1" value="3.0">

                    <label for="directionCount" style="margin-top: 15px;">Direction Count:</label>
                    <select id="directionCount">
                        <option value="8">8 Directions</option>
                        <option value="16">16 Directions</option>
                    </select>
                </div>

                <div class="control-group">
                    <h3>üì∏ Generate Sprites</h3>
                    <button id="generateBtn" disabled>Generate 8-Direction Sprites</button>
                    <button id="downloadBtn" disabled>Download ZIP Archive</button>
                    <div class="success-message" id="successMessage">
                        ‚úì Sprites generated successfully!
                    </div>
                </div>
            </div>

            <div class="viewport">
                <canvas id="canvas3d"></canvas>
                <div class="loading" id="loading" style="display: none;">
                    <div class="spinner"></div>
                    <div class="loading-status" id="loadingStatus">Loading model...</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <div class="error-message" id="errorMessage">
                    <h3>‚ö†Ô∏è Error Loading Model</h3>
                    <p id="errorText"></p>
                    <button onclick="document.getElementById('errorMessage').style.display='none'">Close</button>
                </div>
            </div>
        </div>

        <div class="sprite-preview" id="spritePreview" style="display: none;">
            <!-- Sprites will be inserted here -->
        </div>
    </div>

    <!-- Modal for sprite zoom -->
    <div class="sprite-modal" id="spriteModal">
        <div class="sprite-modal-content">
            <span class="sprite-modal-close" id="modalClose">&times;</span>
            <img id="modalImage" src="" alt="Sprite preview">
            <p id="modalCaption"></p>
        </div>
    </div>

    <!-- Third-party libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <!-- fflate is required for FBX loader to decompress FBX files -->
    <script src="https://cdn.jsdelivr.net/npm/fflate@0.7.4/umd/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Application modules (order matters) -->
    <script src="js/config.js"></script>
    <!-- Utility classes (no dependencies) -->
    <script src="js/sprite.js"></script>
    <script src="js/animation-frame-calculator.js"></script>
    <script src="js/animation-library.js"></script>
    <!-- Core modules -->
    <script src="js/ui-controller.js"></script>
    <script src="js/three-setup.js"></script>
    <script src="js/model-loader.js"></script>
    <script src="js/animation-controller.js"></script>
    <script src="js/sprite-generator.js"></script>
    <script src="js/file-handler.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
